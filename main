import pygame
import hero
import knight
import ground
import os
from pygame import *
from ground import*
from hero import *

height = 500
width = 700
level_amount = 1

FILE_DIR = os.path.dirname(__file__)

def load_level(n, level):
    c_level = '%s/levels/' + str(n) + '.txt'
    
    levelfile = open(c_level % FILE_DIR)
    line = " "
    tasks = []
    line = levelfile.readline()
    while line[0] != "/":
        line = levelfile.readline()
        if line[0] == '[':
            line = levelfile.readline()
            while line[0] != "]":
                ending = line.find("|")
                level.append(line[0: ending])
                line = levelfile.readline()
    
def screen_saver():
    pygame.init()
    started = False
    screen = pygame.display.set_mode((width, height))
    pygame.display.set_caption("Obey Dark Lord")
    bg = Surface((width, height))     
    
    background_image=pygame.image.load("screensaver.jpg").convert()
    while not started:
        for e in pygame.event.get():
            if e.type == pygame.KEYDOWN and e.key == pygame.K_SPACE:
                started = True
            screen.blit(background_image, (0,0))
        pygame.display.update()      

def main():
    pygame.init()
    done = False
    screen = pygame.display.set_mode((width, height))
    pygame.display.set_caption("Obey Dark Lord")
    bg = Surface((width, height))
    background_image = pygame.image.load("background_1.jpg").convert()
    
    for i in range(level_amount):
        level = []
        load_level(i + 1, level)
        entities = pygame.sprite.Group()
        grave = [] 
        playerX = 255
        playerY = 255

        x = 0
        y = 0
        for row in level:
            for col in row:
                if col == "-":
                    pf = Ground(x,y)
                    entities.add(pf)
                    grave.append(pf)
                x += gr_width
            y += gr_height
            x = 0
        hero = Player(playerX,playerY)       
        entities.add(hero)
        
        timer = pygame.time.Clock()
        left = right = up = 0
        while not done:
            timer.tick(60)
            for e in pygame.event.get():
                if e.type == QUIT: #event handling
                    done = True
                if e.type == KEYDOWN and e.key == K_UP:
                    up = True
                if e.type == KEYDOWN and e.key == K_LEFT:
                    left = True
                if e.type == KEYDOWN and e.key ==   K_RIGHT:
                    right = True
                if e.type == KEYUP and e.key == K_UP:
                    up = False
                if e.type == KEYUP and e.key == K_RIGHT:
                    right = False
                if e.type == KEYUP and e.key == K_LEFT:
                    left = False    
            hero.update(left, right, up, entities)      
            screen.blit(background_image, (0,0))
            entities.draw(screen)
            pygame.display.update()

        pygame.quit()

if __name__ == "__main__":
    screen_saver()
    main()        
